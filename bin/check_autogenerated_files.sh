#!/bin/bash

# ###
# check_autogenerated_files.sh
# ###
# Makes sure that autogenerated files were regenerated after making changes to the source.
# ###
echo "Downloading configlet"
bin/fetch-configlet
echo "Running 'configlet generate'"
bin/configlet generate

echo "Checking git diff"
git diff --exit-code HEAD
GIT_DIFF_EXIT_CODE="$?"

if [ "$GIT_DIFF_EXIT_CODE" -ne 0 ]
then
  echo "Autogenerated files check failed. Please run \`configlet generate\` and commit in the changes."
  exit 1;
fi

echo "Autogenerated files check passed"
exit 0;
